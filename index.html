<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninja Tips</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Orbitron, Inter, and Bebas Neue -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --brand-blue: #0278CA;
            --brand-blue-light: #3593d9;
            --brand-blue-shadow: rgba(2, 120, 202, 0.2);
            --brand-blue-shadow-vip: rgba(2, 120, 202, 0.3);
        }
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #f1f1f1; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .font-bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.05em; }
        .header-bg { background: linear-gradient(to right, #1a1a1a, #000000); border-bottom: 2px solid var(--brand-blue); }
        .card-bg { background-color: #1a1a1a; border: 1px solid #333; transition: all 0.3s ease; }
        .card-bg:hover { transform: translateY(-3px); box-shadow: 0 4px 12px var(--brand-blue-shadow); border-color: var(--brand-blue); }
        .tab-button { transition: all 0.3s ease; border-bottom: 3px solid transparent; padding: 10px 16px; }
        .tab-button.active { color: var(--brand-blue); border-bottom-color: var(--brand-blue); background-color: #111; border-radius: 6px 6px 0 0; }
        .tab-button:not(.active):hover { color: var(--brand-blue-light); }
        .sub-tab-button { padding: 6px 12px; border-radius: 6px; background-color: transparent; color: #a1a1aa; font-weight: 500; transition: all 0.3s ease; }
        .sub-tab-button.active { background-color: var(--brand-blue); color: white; }
        .sub-tab-button:not(.active):hover { background-color: #27272a; }
        /* Status Colors */
        .status-won { background-color: #16a34a; color: white; }
        .status-lost { background-color: #dc2626; color: white; }
        .status-pending { background-color: var(--brand-blue); color: white; }
        .status-refund { background-color: #ca8a04; color: white; } /* Darker Yellow for Refund */
        .status-50win { background: linear-gradient(90deg, #16a34a 50%, #ca8a04 50%); color: white; } /* Half Green, Half Yellow */
        .status-50refund { background-color: #f97316; color: white; } /* Orange for 50% Refund/Loss */
        
        .telegram-button { background-color: #229ED9; box-shadow: 0 4px 14px 0 rgba(0, 118, 163, 0.39); }
        .telegram-button:hover { background-color: #1a8cd8; }
        .vip-card { background: linear-gradient(145deg, #2a2a2a, #1a1a1a); border: 1px solid var(--brand-blue); box-shadow: 0 0 20px var(--brand-blue-shadow-vip); }
        .status-badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 9999px; font-weight: 700; text-transform: uppercase; }
        .text-brand-blue { color: var(--brand-blue); }
        .border-brand-blue { border-color: var(--brand-blue); }
        .loader { border: 4px solid #333; border-radius: 50%; border-top: 4px solid var(--brand-blue); width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 40px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased">

    <!-- Header Section -->
    <header class="header-bg shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-start h-16">
                <div class="flex items-center">
                    <img src="https://masterthreeplus.github.io/ninjatips/icon/Logo.png" alt="Ninja Tips Logo" class="h-12">
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Main Tab Navigation -->
        <div class="mb-6 border-b border-gray-700">
            <nav class="flex justify-center -mb-px space-x-2 sm:space-x-6 overflow-x-auto whitespace-nowrap">
                <button id="free-tips-tab" class="tab-button active text-base font-semibold">
                    <i class="fas fa-globe mr-2"></i>Free Tips
                </button>
                <button id="vip-tips-tab" class="tab-button text-base font-semibold">
                    <i class="fas fa-star mr-2"></i>VIP Tips
                </button>
            </nav>
        </div>

        <!-- Tips Sections -->
        <div id="tips-content">
            <!-- Free Tips Section -->
            <section id="free-tips-section">
                <div class="mb-5 flex justify-center p-1 bg-gray-800 rounded-lg max-w-xs mx-auto">
                    <button id="single-tip-sub-tab" class="sub-tab-button active w-1/2 text-sm">Single Tip</button>
                    <button id="safe-slip-sub-tab" class="sub-tab-button w-1/2 text-sm">Safe Slip</button>
                </div>
                <div id="single-tip-content">
                    <div id="single-tips-container" class="space-y-6"><div class="loader"></div></div>
                </div>
                <div id="safe-slip-content" class="hidden">
                    <div id="safe-slips-container" class="space-y-6"><div class="loader"></div></div>
                </div>
            </section>

            <!-- VIP Tips Section -->
            <section id="vip-tips-section" class="hidden">
                 <div class="vip-card rounded-lg p-6 text-center mb-6">
                    <i class="fas fa-crown text-4xl text-yellow-400 mb-3"></i>
                    <h2 class="text-2xl font-bold font-orbitron text-white mb-2">VIP Member Access</h2>
                    <p class="text-gray-300 text-sm max-w-xl mx-auto mb-5">VIP အဖွဲ့ဝင်ဖြစ်ခြင်းဖြင့် ပိုမိုတိကျသေချာသော ခန့်မှန်းချက်များ၊ အကောင်းဆုံး Odds များနှင့် အထူးပွဲစဉ်များကို နေ့စဉ် ရယူလိုက်ပါ။</p>
                    <a href="https://t.me/your_telegram_username" target="_blank" class="telegram-button text-white font-bold py-2 px-5 rounded-lg inline-flex items-center"><i class="fab fa-telegram-plane mr-2"></i><span>Join VIP Now</span></a>
                </div>
                <div id="vip-accumulator-container" class="space-y-6"><div class="loader"></div></div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-gray-800 mt-10 py-5">
        <div class="container mx-auto text-center text-gray-500 text-sm">
            <p>&copy; <span id="year"></span> Ninja Tips. All Rights Reserved.</p>
            <div class="flex justify-center space-x-4 mt-3">
                <a href="https://t.me/your_telegram_username" target="_blank" class="text-brand-blue hover:underline"><i class="fab fa-telegram"></i> Telegram</a>
                <a href="https://facebook.com/your_page" target="_blank" class="text-brand-blue hover:underline"><i class="fab fa-facebook"></i> Facebook</a>
            </div>
            <p class="text-xs mt-3">ဘောလုံးခန့်မှန်းချက်များသည် 참고용으로만 အသုံးပြုသင့်ပါသည်။</p>
        </div>
    </footer>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxqCf7G-gJ03ZaG7aC3KN7BSQPuhGyJ5_AMzRI_4ljx4ShTryQRPcEQOId_u6USst2XlA/exec';

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const options = { day: "2-digit", month: "short", year: "numeric" };
            return new Date(dateStr + 'T00:00:00').toLocaleDateString("en-GB", options);
        }

        function createTipCard(tip) {
            const status = String(tip.status || '').toUpperCase();
            let statusClass = '';
            switch (status) {
                case 'WON': statusClass = 'status-won'; break;
                case 'LOST': statusClass = 'status-lost'; break;
                case 'PENDING': statusClass = 'status-pending'; break;
                case 'REFUND': statusClass = 'status-refund'; break;
                case '50WIN': statusClass = 'status-50win'; break;
                case '50REFUND': statusClass = 'status-50refund'; break;
            }

            let displayOdd = tip.odds;
            const originalOdd = parseFloat(tip.odds || 1);

            if (status === '50WIN') {
                displayOdd = (((originalOdd - 1) / 2) + 1).toFixed(2);
            } else if (status === '50REFUND') {
                displayOdd = '0.50';
            }

            return `
                <div class="card-bg rounded-lg p-4 flex flex-col space-y-3">
                    <div class="flex justify-between items-start">
                        <div class="text-left text-xs text-gray-400 font-bold">
                            <p><i class="fas fa-flag mr-1 text-brand-blue"></i> ${tip.country || ''} - ${tip.league || ''}</p>
                        </div>
                        <span class="status-badge ${statusClass}">${tip.status || ''}</span>
                    </div>
                    <div class="text-center font-bold text-base text-white">
                        <p>${tip.home_team || ''} vs ${tip.away_team || ''}</p>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <div class="font-semibold text-brand-blue">
                           <span class="text-base font-bold">${tip.tip || ''}</span>
                        </div>
                        <div class="font-bold text-gray-300">
                            Odds: <span class="text-white">${displayOdd || ''}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function createSlipGroup(tipsForSlip, titlePrefix) {
            const totalOdds = tipsForSlip.reduce((acc, tip) => {
                const status = String(tip.status || '').toUpperCase();
                const odd = parseFloat(tip.odds || 1);
                if (status === 'REFUND') {
                    return acc * 1;
                }
                if (status === '50WIN') {
                    return acc * ((odd - 1) / 2 + 1);
                }
                if (status === '50REFUND') {
                    return acc * 0.5;
                }
                return acc * odd;
            }, 1);

            let dayStatus = 'WON';
            if (tipsForSlip.some(tip => String(tip.status || '').toUpperCase() === 'LOST')) {
                dayStatus = 'LOST';
            } else if (tipsForSlip.some(tip => String(tip.status || '').toUpperCase() === 'PENDING')) {
                dayStatus = 'PENDING';
            }
            const dayStatusClass = `status-${dayStatus.toLowerCase()}`;

            const sortedTips = [...tipsForSlip].sort((a, b) => new Date(a.date) - new Date(b.date));
            const earliestDateString = sortedTips.length > 0 ? sortedTips[0].date : null;
            
            const tipCardsHTML = sortedTips.map(createTipCard).join('');

            return `
                <div class="card-bg rounded-lg p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bebas tracking-wider text-brand-blue">${titlePrefix} - ${formatDate(earliestDateString)}</h3>
                    </div>
                    <div class="space-y-3">
                        ${tipCardsHTML}
                    </div>
                    <div class="border-t-2 border-brand-blue mt-4 pt-3 flex justify-between items-center">
                        <span class="status-badge ${dayStatusClass}">${dayStatus}</span>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-bold text-white">Total Odds:</span>
                            <span class="text-3xl font-bebas tracking-wider text-brand-blue">${totalOdds.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
            `;
        }


        document.addEventListener('DOMContentLoaded', async () => {
            const freeTipsTab = document.getElementById('free-tips-tab');
            const vipTipsTab = document.getElementById('vip-tips-tab');
            const freeTipsSection = document.getElementById('free-tips-section');
            const vipTipsSection = document.getElementById('vip-tips-section');
            const singleTipSubTab = document.getElementById('single-tip-sub-tab');
            const safeSlipSubTab = document.getElementById('safe-slip-sub-tab');
            const singleTipContent = document.getElementById('single-tip-content');
            const safeSlipContent = document.getElementById('safe-slip-content');

            async function loadAllData() {
                try {
                    const response = await fetch(API_URL, { redirect: 'follow', cache: 'no-cache' });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    renderSingleTips(data.singleTips || []);
                    renderAccumulators('safe-slips-container', data.safeSlips || [], 'SAFE SLIP');
                    renderAccumulators('vip-accumulator-container', data.vipTips || [], 'VIP');
                } catch (error) {
                    console.error("Error loading data:", error);
                    const errorMessage = `<div class="text-center text-red-400 p-4 card-bg rounded-lg"><p class="font-bold text-lg mb-2">API Error</p><p class="text-sm">ဒေတာများ ရယူ၍မရပါ၊ Apps Script ကို မှန်ကန်စွာ Deploy လုပ်ထားကြောင်း စစ်ဆေးပါ။</p></div>`;
                    document.getElementById('single-tips-container').innerHTML = errorMessage;
                    document.getElementById('safe-slips-container').innerHTML = errorMessage;
                    document.getElementById('vip-accumulator-container').innerHTML = errorMessage;
                }
            }

            function renderSingleTips(data) {
                const container = document.getElementById('single-tips-container');
                container.innerHTML = '';
                if (!data || data.length === 0) {
                    container.innerHTML = `<p class="text-center text-gray-400">ခန့်မှန်းချက်များ မရှိသေးပါ။</p>`;
                    return;
                }
                const groupedTips = data.reduce((acc, tip) => {
                    const date = tip.date.split('T')[0];
                    (acc[date] = acc[date] || []).push(tip);
                    return acc;
                }, {});
                const sortedDates = Object.keys(groupedTips).sort((a, b) => new Date(b) - new Date(a));
                sortedDates.forEach(date => {
                    const dateSection = document.createElement('section');
                    dateSection.innerHTML = `
                        <h2 class="text-base font-semibold text-gray-300 mb-2 pl-1">${formatDate(date)}</h2>
                        <div class="space-y-3">${groupedTips[date].map(createTipCard).join('')}</div>
                    `;
                    container.appendChild(dateSection);
                });
            }

            function renderAccumulators(containerId, data, titlePrefix) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                if (!data || data.length === 0) {
                    container.innerHTML = `<p class="text-center text-gray-400">ခန့်မှန်းချက်များ မရှိသေးပါ။</p>`;
                    return;
                }
                const groupedBySlipId = data.reduce((acc, tip) => {
                    const slipId = tip.slip_id || `default-${tip.date}`;
                    (acc[slipId] = acc[slipId] || []).push(tip);
                    return acc;
                }, {});
                const sortedSlipIds = Object.keys(groupedBySlipId).sort((a, b) => {
                    const dateA = new Date(groupedBySlipId[a][0].date);
                    const dateB = new Date(groupedBySlipId[b][0].date);
                    return dateB - dateA;
                });
                sortedSlipIds.forEach(slipId => {
                    container.innerHTML += createSlipGroup(groupedBySlipId[slipId], titlePrefix);
                });
            }

            freeTipsTab.addEventListener('click', () => {
                freeTipsTab.classList.add('active'); vipTipsTab.classList.remove('active');
                freeTipsSection.classList.remove('hidden'); vipTipsSection.classList.add('hidden');
            });
            vipTipsTab.addEventListener('click', () => {
                vipTipsTab.classList.add('active'); freeTipsTab.classList.remove('active');
                vipTipsSection.classList.remove('hidden'); freeTipsSection.classList.add('hidden');
            });
            singleTipSubTab.addEventListener('click', () => {
                singleTipSubTab.classList.add('active'); safeSlipSubTab.classList.remove('active');
                singleTipContent.classList.remove('hidden'); safeSlipContent.classList.add('hidden');
            });
            safeSlipSubTab.addEventListener('click', () => {
                safeSlipSubTab.classList.add('active'); singleTipSubTab.classList.remove('active');
                safeSlipContent.classList.remove('hidden'); singleTipContent.classList.add('hidden');
            });

            loadAllData();
            document.getElementById('year').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>
